---
# This playbook is ONLY to be used when updating config files on agent machines. 
# REMEMBER TO ADD ALL IP ADDRS TO /etc/ansible/hosts
- hosts: all
  become: yes
  become_user: root
  tasks: 
  - name: Copy osquery.conf to agents
    copy:
      src: "ansible-wazuh-agent/files/osquery.conf"
      dest: /etc/osquery/osquery.conf
    notify: 
      - restart wazuh-agent
      - restart osqueryd

  - name: Copy audit.rules to agents
    copy:
      src: "ansible-wazuh-agent/files/audit.rules"
      dest: /etc/audit/rules.d/audit.rules
    notify: restart wazuh-agent

  - name: Reload rules
    shell: "auditctl -R /etc/audit/rules.d/audit.rules"

  handlers:
    - name: restart wazuh-agent
      service: name=wazuh-agent state=restarted enabled=yes

    - name: restart osqueryd
      service: name=osqueryd state=restarted enabled=yes

# you can reload using auditctl -l but it's kinda pointless to put this in the script bc you won't see the output
