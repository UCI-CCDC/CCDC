<!--
  - custom & modified wazuh rules for CCDC usage
  - author: jbokor@uci.edu, UCI CCDC
  - 02/2022
--> 
<group name="CUSTOM RULES">


    <!-- MODIFIED RULES -->
    <rule id="5303" level="5" overwrite="yes">
      <if_sid>5300</if_sid>
      <regex>session opened for user root|^'su root'|</regex>
      <regex>^+ \S+ \S+\proot$|^\S+ to root on|^SU \S+ \S+ + \S+ \S+-root$</regex>
      <description>User successfully changed UID to root.</description>
      <mitre>
        <id>T1078</id>
      </mitre>
      <group>authentication_success,pci_dss_10.2.5,gpg13_7.6,gpg13_7.8,gpg13_7.9,gdpr_IV_35.7.d,gdpr_IV_32.2,hipaa_164.312.b,nist_800_53_AU.14,nist_800_53_AC.7,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
    </rule>

    <rule id="10100" level="6" overwrite="yes">
      <if_group>authentication_success</if_group>
      <if_fts />
      <group>authentication_success,</group>
      <description>First time user logged in.</description>
      <mitre>
        <id>T1078</id>
      </mitre>
    </rule>

    <!-- CUSTOM RULES -->
    <rule id="100009" level="2">
      <if_group>syscheck</if_group>
      <field name="file">/root/.viminfo</field>
      <match>modified</match>
      <description>viminfo (vim history file) updated</description>
    </rule>

    <rule id="100010" level="10">
      <if_group>syscheck</if_group>
      <match>modified|added|deleted</match>
      <field name="file">^/etc/cron.</field>
      <description>File changed inside Cron!</description>
    </rule>

    <rule id="100011" level="3">
      <if_group>syscheck</if_group>
      <match>/etc/resolv.conf</match>
      <description>resolv.conf modified, big whoop</description>
    </rule>

    <rule id="100012" level="10">
      <if_group>syscheck</if_group>
      <match>/etc/pam</match>
      <description>PAM configuration modified!</description>
    </rule>

    <rule id="100013" level="9">
      <if_group>syscheck</if_group>
      <field name="file">authorized_keys$</field>
      <match>modified</match>
      <description>authorized_keys updated, UHOH</description>
    </rule>

<!-- read internal docs for more info if this isn't working as expected -->
    <rule id="100014" level="12">
      <if_group>syscheck</if_group>
      <field name="changed_content">thug|THUG</field>
      <match>modified</match>
      <description>WORD "thug" HAS BEEN ADDED TO FILE</description>
    </rule>

<!-- REMOVING ANNOYING ALERTS -->
    <rule id="24001" level="2" overwrite="yes"> 
      <if_sid>24000</if_sid> 
      <regex>^E\d\d\d\d </regex> 
      <description>osquery already running</description> 
    </rule>


    <rule id="100900" level="2">
      <if_sid>24000</if_sid>
      <regex>^E\d\d\d\d </regex>
      <match>already\srunning</match>
      <description>osquery is already running, this error is stupid</description>
    </rule>

<!-- AUDITD rules -->
    <rule id="100200" level="7">
        <if_sid>80792</if_sid>
        <list field="audit.command" lookup="match_key">etc/lists/suspicious-programs</list>
        <description>Audit: Suspicious Command: $(audit.exe)</description>
        <group>audit_command,</group>
    </rule>

    <rule id="100210" level="10">
        <if_sid>80792</if_sid>
        <list field="audit.command" lookup="match_key_value" check_value="red">etc/lists/suspicious-programs</list>
        <description>Audit: Highly Suspicious Command executed: $(audit.exe)</description>
        <group>audit_command,</group>
    </rule>

</group>
